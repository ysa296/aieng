<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoStudy Hub - Digital Learning Solution</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --secondary: #0ea5e9;
            --bg: #f8fafc;
            --surface: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --success: #22c55e;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        header {
            background-color: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            flex-shrink: 0;
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-badge {
            font-size: 0.85rem;
            background: #dcfce7;
            color: #166534;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* --- Layout --- */
        .app-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar */
        aside {
            width: 260px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            gap: 0.5rem;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
            text-align: left;
        }

        .nav-btn:hover {
            background: #f1f5f9;
            color: var(--primary);
        }

        .nav-btn.active {
            background: #e0e7ff;
            color: var(--primary);
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            position: relative;
        }

        /* --- Views --- */
        .view-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .view-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Library & Search --- */
        .top-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            outline: none;
        }
        
        .search-box svg {
            position: absolute;
            left: 0.8rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            width: 18px;
            height: 18px;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.2s;
        }

        .btn:hover {
            background: var(--primary-hover);
        }

        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .file-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .file-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .file-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--secondary);
        }

        .file-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* --- Viewer & Annotation --- */
        .viewer-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            height: calc(100vh - 180px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .viewer-toolbar {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            background: #f8fafc;
        }

        .tool-group {
            display: flex;
            gap: 0.5rem;
        }

        .tool-btn {
            padding: 0.5rem;
            border: 1px solid var(--border);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-main);
        }
        
        .tool-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .canvas-wrapper {
            position: relative;
            flex: 1;
            background: #525659;
            overflow: auto;
            display: flex;
            justify-content: center;
            padding: 2rem;
        }

        #annotationCanvas {
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            cursor: crosshair;
        }

        /* --- Chatbot --- */
        .chat-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            height: calc(100vh - 180px);
            display: flex;
            flex-direction: column;
        }

        .chat-history {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 80%;
            padding: 1rem;
            border-radius: 12px;
            line-height: 1.5;
        }

        .msg-ai {
            background: #f1f5f9;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }

        .msg-user {
            background: var(--primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }

        .chat-input-area {
            padding: 1rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 1rem;
        }

        .chat-input-area input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            outline: none;
        }

        /* --- Toast Notification --- */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #1e293b;
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            transform: translateY(100px);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000;
        }
        
        .toast.show {
            transform: translateY(0);
        }

        /* Hidden inputs */
        #fileInput {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            aside { width: 100%; height: auto; flex-direction: row; overflow-x: auto; border-right: none; border-bottom: 1px solid var(--border); }
            .nav-btn { flex-shrink: 0; }
        }
    </style>
</head>
<body>

    <!-- Notification Toast -->
    <div id="toast" class="toast">Notification</div>

    <!-- Hidden File Input -->
    <input type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg,.txt">

    <header>
        <div class="brand">
            <!-- Leaf Icon -->
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>
            EcoStudy Hub
        </div>
        <div class="status-badge">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4"/><path d="M12 18v4"/><path d="M4.93 4.93l2.83 2.83"/><path d="M16.24 16.24l2.83 2.83"/><path d="M2 12h4"/><path d="M18 12h4"/><path d="M4.93 19.07l2.83-2.83"/><path d="M16.24 7.76l2.83-2.83"/></svg>
            Offline Ready
        </div>
    </header>

    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside>
            <button class="nav-btn active" onclick="showSection('library')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                Library & Resources
            </button>
            <button class="nav-btn" onclick="showSection('viewer')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-6"/><path d="M9 15l3 3 3-3"/></svg>
                Annotation & Notes
            </button>
            <button class="nav-btn" onclick="showSection('chat')">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                Study Chatbot
            </button>
        </aside>

        <main>
            <!-- SECTION 1: LIBRARY -->
            <section id="library" class="view-section active">
                <div class="top-bar">
                    <div>
                        <h2>My Digital Resources</h2>
                        <p style="color: var(--text-muted); margin-top: 4px;">Store and view your learning materials</p>
                    </div>
                    <button class="btn" onclick="document.getElementById('fileInput').click()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        Upload Document
                    </button>
                </div>

                <div class="search-box" style="margin-bottom: 2rem;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    <input type="text" id="searchInput" placeholder="Search notes by name..." oninput="filterLibrary()">
                </div>

                <div id="fileGrid" class="file-grid">
                    <!-- Javascript will populate this -->
                </div>
            </section>

            <!-- SECTION 2: VIEWER & ANNOTATION -->
            <section id="viewer" class="view-section">
                <div class="top-bar">
                    <div>
                        <h2>Annotation Mode</h2>
                        <p style="color: var(--text-muted); margin-top: 4px;">Draw highlights or write notes on your material</p>
                    </div>
                    <button class="btn" style="background-color: var(--secondary);" onclick="clearCanvas()">
                        Clear Notes
                    </button>
                </div>

                <div class="viewer-container">
                    <div class="viewer-toolbar">
                        <div class="tool-group">
                            <button class="tool-btn active" id="btnPen" onclick="setTool('pen')">‚úèÔ∏è Pen</button>
                            <button class="tool-btn" id="btnHighlight" onclick="setTool('highlight')">üñçÔ∏è Highlight</button>
                        </div>
                        <div class="tool-group">
                            <button class="tool-btn" onclick="saveAnnotation()">üíæ Save</button>
                        </div>
                    </div>
                    <div class="canvas-wrapper">
                        <!-- Canvas acts as the annotation layer -->
                        <canvas id="annotationCanvas" width="800" height="1000"></canvas>
                    </div>
                </div>
            </section>

            <!-- SECTION 3: CHATBOT -->
            <section id="chat" class="view-section">
                <div class="top-bar">
                    <div>
                        <h2>AI Study Assistant</h2>
                        <p style="color: var(--text-muted); margin-top: 4px;">Ask for practice questions or summaries</p>
                    </div>
                </div>

                <div class="chat-container">
                    <div id="chatHistory" class="chat-history">
                        <div class="message msg-ai">
                            Hello! I'm your EcoStudy Assistant. Upload a document or ask me to generate practice questions for any topic!
                        </div>
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="chatInput" placeholder="Ask for practice questions..." onkeypress="handleChatEnter(event)">
                        <button class="btn" onclick="sendMessage()">Send</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // --- State Management ---
        const appState = {
            documents: JSON.parse(localStorage.getItem('ecoDocs')) || [
                { id: 1, name: 'Biology_Chapter1.pdf', type: 'pdf', date: '2023-10-24' },
                { id: 2, name: 'Math_Formulas.png', type: 'image', date: '2023-10-25' },
                { id: 3, name: 'History_Notes.txt', type: 'text', date: '2023-10-26' }
            ],
            currentTool: 'pen', // pen, highlight
            isDrawing: false,
            currentDocId: null
        };

        // --- DOM Elements ---
        const toastEl = document.getElementById('toast');
        const fileInput = document.getElementById('fileInput');
        const fileGrid = document.getElementById('fileGrid');
        const canvas = document.getElementById('annotationCanvas');
        const ctx = canvas.getContext('2d');
        const chatHistory = document.getElementById('chatHistory');
        const chatInput = document.getElementById('chatInput');

        // --- Initialization ---
        window.addEventListener('DOMContentLoaded', () => {
            renderLibrary();
            initCanvas();
            
            // Load saved annotations if any
            const savedData = localStorage.getItem('ecoCanvasData');
            if(savedData) {
                const img = new Image();
                img.onload = function() {
                    ctx.drawImage(img, 0, 0);
                };
                img.src = savedData;
            }
        });

        // --- Navigation Logic ---
        function showSection(sectionId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            // Find the button that calls this function
            const btns = document.querySelectorAll('.nav-btn');
            if(sectionId === 'library') btns[0].classList.add('active');
            if(sectionId === 'viewer') btns[1].classList.add('active');
            if(sectionId === 'chat') btns[2].classList.add('active');
        }

        // --- Feature 2: Digital Storage & Viewing ---
        fileInput.addEventListener('change', (e) => {
            if(e.target.files.length > 0) {
                const file = e.target.files[0];
                const newDoc = {
                    id: Date.now(),
                    name: file.name,
                    type: file.type.split('/')[0] || 'unknown',
                    date: new Date().toLocaleDateString()
                };
                appState.documents.unshift(newDoc);
                saveData();
                renderLibrary();
                showToast(`Uploaded: ${file.name}`);
                
                // Automatically switch to viewer to "simulate" opening it
                openDocument(newDoc);
            }
        });

        function renderLibrary() {
            fileGrid.innerHTML = '';
            appState.documents.forEach(doc => {
                const card = document.createElement('div');
                card.className = 'file-card';
                card.onclick = () => openDocument(doc);
                
                let icon = 'üìÑ';
                if(doc.type === 'image') icon = 'üñºÔ∏è';
                if(doc.type === 'pdf') icon = 'üìï';
                
                card.innerHTML = `
                    <div class="file-icon">${icon}</div>
                    <div class="file-title" title="${doc.name}">${doc.name}</div>
                    <div class="file-meta">${doc.date}</div>
                `;
                fileGrid.appendChild(card);
            });
        }

        function openDocument(doc) {
            showToast(`Opening ${doc.name}...`);
            showSection('viewer');
            // In a real app, this would render the file content to the canvas background
            // For this demo, we draw a placeholder title on the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0,0, canvas.width, canvas.height);
            
            // Draw "Document" look
            ctx.fillStyle = "#334155";
            ctx.font = "24px Arial";
            ctx.fillText(`Document: ${doc.name}`, 50, 50);
            ctx.font = "16px Arial";
            ctx.fillStyle = "#64748b";
            ctx.fillText("(Simulated Content for Demo)", 50, 80);
            
            // Draw some lines to represent text
            ctx.fillStyle = "#cbd5e1";
            for(let i=0; i<20; i++) {
                ctx.fillRect(50, 120 + (i*30), 700, 10);
            }
        }

        // --- Feature 3: Search ---
        function filterLibrary() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const cards = document.querySelectorAll('.file-card');
            cards.forEach(card => {
                const title = card.querySelector('.file-title').innerText.toLowerCase();
                if(title.includes(term)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // --- Feature 5: Annotation (Canvas) ---
        function initCanvas() {
            // Mouse Events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch Events (for mobile)
            canvas.addEventListener('touchstart', (e) => startDrawing(e.touches[0]));
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                draw(e.touches[0]);
            });
            canvas.addEventListener('touchend', stopDrawing);
        }

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        function startDrawing(e) {
            appState.isDrawing = true;
            const pos = getPos(e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
            
            if(appState.currentTool === 'pen') {
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 2;
                ctx.globalAlpha = 1.0;
            } else {
                ctx.strokeStyle = '#ffff00'; // Highlighter yellow
                ctx.lineWidth = 15;
                ctx.globalAlpha = 0.5;
            }
        }

        function draw(e) {
            if(!appState.isDrawing) return;
            const pos = getPos(e);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
        }

        function stopDrawing() {
            if(appState.isDrawing) {
                appState.isDrawing = false;
                ctx.closePath();
            }
        }

        function setTool(tool) {
            appState.currentTool = tool;
            document.getElementById('btnPen').classList.toggle('active', tool === 'pen');
            document.getElementById('btnHighlight').classList.toggle('active', tool === 'highlight');
        }

        function clearCanvas() {
            if(confirm("Clear all annotations?")) {
                // Redraw basic document look
                ctx.clearRect(0,0, canvas.width, canvas.height);
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(0,0, canvas.width, canvas.height);
                localStorage.removeItem('ecoCanvasData');
                showToast("Annotations cleared");
            }
        }

        function saveAnnotation() {
            const dataURL = canvas.toDataURL();
            localStorage.setItem('ecoCanvasData', dataURL);
            showToast("Annotations saved for offline use!");
        }

        // --- Feature 4: Study Chatbot ---
        function handleChatEnter(e) {
            if(e.key === 'Enter') sendMessage();
        }

        function sendMessage() {
            const text = chatInput.value.trim();
            if(!text) return;

            // User Message
            addMessage(text, 'user');
            chatInput.value = '';

            // Simulate AI Delay
            const loadingId = addMessage("Thinking...", 'ai');

            setTimeout(() => {
                // Remove loading message
                const loadingEl = document.getElementById(loadingId);
                if(loadingEl) loadingEl.remove();

                // Generate Response based on keywords
                let response = "I can help you with that. Could you provide more context?";
                
                if(text.toLowerCase().includes('question')) {
                    response = generatePracticeQuestions();
                } else if (text.toLowerCase().includes('hello') || text.toLowerCase().includes('hi')) {
                    response = "Hello! Ready to study? Ask me to generate questions for your notes.";
                } else if (text.toLowerCase().includes('summary')) {
                    response = "To summarize: You should focus on key terms and definitions in your uploaded materials.";
                }

                addMessage(response, 'ai');
            }, 1000);
        }

        function addMessage(text, sender) {
            const id = 'msg-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = `message msg-${sender}`;
            div.innerText = text;
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
            return id;
        }

        function generatePracticeQuestions() {
            const questions = [
                "1. What are the three main causes of the discussed phenomenon?",
                "2. Explain the significance of the date mentioned in the document.",
                "3. True or False: The secondary factors have no impact on the outcome.",
                "4. Describe the relationship between concept A and concept B.",
                "5. Based on your notes, what would be a real-world application of this theory?"
            ];
            // Pick 2 random questions
            const shuffled = questions.sort(() => 0.5 - Math.random());
            return "Here are some practice questions based on general study patterns:\n\n" + shuffled.slice(0, 3).join('\n');
        }

        // --- Utilities ---
        function showToast(msg) {
            toastEl.innerText = msg;
            toastEl.classList.add('show');
            setTimeout(() => toastEl.classList.remove('show'), 3000);
        }

        function saveData() {
            localStorage.setItem('ecoDocs', JSON.stringify(appState.documents));
        }
    </script>
</body>
</html>